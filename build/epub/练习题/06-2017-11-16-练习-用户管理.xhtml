<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>06-2017-11-16-练习-用户管理</title>
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> 
  </head>
  <body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>06-2017-11-16-练习-用户管理</h1>
<div class="section" id="useradd-usermod">
<h2>练习1-useradd,usermod</h2>
<p>1、创建用户gentoo，附加组为distro和linux,默认shell为/bin/csh,注释信息&quot;gentoo distribution&quot;</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># useradd -G distro,linux -s /bin/csh -c &quot;gentoo distribution&quot; gentoo</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>练习2-恢复用户家目录</h2>
<p>1、创建好的用户wang,用户家目录被删除的，如何还原。</p>
<p>模拟一个破坏环境</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># useradd wang                          #创建用户</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># echo &quot;oracle&quot; | passwd --stdin wang   #设置密码</span>
Changing password <span class="k">for</span> user wang.
passwd: all authentication tokens updated successfully.
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># rm -rf /home/wang                     #模拟恶意删除家目录</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># ll /home/wang                         #查看</span>
ls: cannot access /home/wang: No such file or directory
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># su - test01                        #切换到普通用户</span>
<span class="o">[</span>test01@centos6 ~<span class="o">]</span>$ su - wang                           <span class="c1">#从普通用户切换到wang</span>
Password:
su: warning: cannot change directory to /home/wang: No such file or directory
-bash-4.1$                                                <span class="c1">#这里家目录没有就是-bash-4.1的样子了。</span>
</pre></div>
</div>
<p>修复过程</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># cp -r /etc/skel /home/wang   #复制模板文件夹</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">28</span>
drwx------.  <span class="m">5</span> git       git       <span class="m">4096</span> Nov  <span class="m">9</span> <span class="m">23</span>:51 git
drwx------.  <span class="m">4</span> nginx     nginx     <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:39 nginx
drwx------.  <span class="m">4</span> <span class="nb">test</span>      <span class="nb">test</span>      <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:04 <span class="nb">test</span>
drwx------.  <span class="m">4</span> test01    test01    <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:04 test01
drwx------.  <span class="m">4</span> test03    test03    <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:33 test03
drwxr-xr-x.  <span class="m">4</span> root      root      <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">16</span>:05 wang
drwx------. <span class="m">25</span> zhaojiedi zhaojiedi <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:03 zhaojiedi
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># chown -R  wang:wang wang #修改所有者和组</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># chmod  700 wang        #修改权限700</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># ll                       #检查下权限和所有者</span>
total <span class="m">28</span>
drwx------.  <span class="m">5</span> git       git       <span class="m">4096</span> Nov  <span class="m">9</span> <span class="m">23</span>:51 git
drwx------.  <span class="m">4</span> nginx     nginx     <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:39 nginx
drwx------.  <span class="m">4</span> <span class="nb">test</span>      <span class="nb">test</span>      <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:04 <span class="nb">test</span>
drwx------.  <span class="m">4</span> test01    test01    <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:04 test01
drwx------.  <span class="m">4</span> test03    test03    <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:33 test03
drwx------.  <span class="m">4</span> wang      wang      <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">16</span>:05 wang
drwx------. <span class="m">25</span> zhaojiedi zhaojiedi <span class="m">4096</span> Nov <span class="m">11</span> <span class="m">15</span>:03 zhaojiedi
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># su - test01             #切换到普通用户</span>
<span class="o">[</span>test01@centos6 ~<span class="o">]</span>$ su - wang                <span class="c1">#切换到wang用户</span>
Password:
<span class="o">[</span>wang@centos6 ~<span class="o">]</span>$ l.                         <span class="c1">#查看文件</span>
.  ..  .bash_logout  .bash_profile  .bashrc  .emacs  .gnome2  .mozilla
</pre></div>
</div>
</div>
<div class="section" id="useradd-passwd">
<h2>练习3-useradd,passwd</h2>
<p>1 、创建用户gentoo ，附加组为bin 和root ，默认shell为 为/bin/csh ，注释信息为&quot;Gentoo Distribution&quot;</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># useradd -G bin,root -s /bin/csh -c &quot;Gentoo Distribution&quot; gentoo</span>
</pre></div>
</div>
<p>2 、创建下面的用户、组和组成员关系如下：</p>
<ul class="simple">
<li><p>名字为admins  的组</p></li>
<li><p>用户natasha ，使用admins  作为附属组</p></li>
<li><p>用户harry ，也使用admins  作为附属组</p></li>
<li><p>用户sarah ，不可交互登录系统，且不是admins  的成员，</p></li>
<li><p>natasha ，harry ，sarah 密码都是centos</p></li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># groupadd admins</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># useradd -G admins natasha</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># useradd -G admins harry</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># useradd -s /sbin/nologin</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># useradd -s /sbin/nologin sarah</span>
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># echo &quot;centos&quot; | passwd --stdin natasha</span>
Changing password <span class="k">for</span> user natasha.
passwd: all authentication tokens updated successfully.
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># echo &quot;centos&quot; | passwd --stdin harry</span>
Changing password <span class="k">for</span> user harry.
passwd: all authentication tokens updated successfully.
<span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># echo &quot;centos&quot; | passwd --stdin sarah</span>
Changing password <span class="k">for</span> user sarah.
passwd: all authentication tokens updated successfully.
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>练习4-批量添加用户和修改密码</h2>
<p>批量添加用户</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 home<span class="o">]</span><span class="c1"># echo user{00..10} |tr &quot; &quot; &quot;\n&quot;   |xargs -L  1  useradd  #cent6创建11个用户</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># tail -n 11 /etc/passwd &gt;&gt;need_to_add_users.txt             #cent6把/etc/passwd后面的11行数据到文件中</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># sz need_to_add_users.txt    #在cent6使用sz上传文件</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># rz                          #cent7 接受这个文件</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># newusers  &lt; need_to_add_users.txt #批量添加</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># tail -n 11 /etc/passwd</span>
user00:x:607:608::/home/user00:/bin/bash
user01:x:608:609::/home/user01:/bin/bash
user02:x:609:610::/home/user02:/bin/bash
user03:x:610:611::/home/user03:/bin/bash
user04:x:611:612::/home/user04:/bin/bash
user05:x:612:613::/home/user05:/bin/bash
user06:x:613:614::/home/user06:/bin/bash
user07:x:614:615::/home/user07:/bin/bash
user08:x:615:616::/home/user08:/bin/bash
user09:x:616:617::/home/user09:/bin/bash
user10:x:617:618::/home/user10:/bin/bash
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># id user01</span>
<span class="nv">uid</span><span class="o">=</span><span class="m">608</span><span class="o">(</span>user01<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span><span class="m">609</span><span class="o">(</span>user01<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span><span class="m">609</span><span class="o">(</span>user01<span class="o">)</span>
</pre></div>
</div>
<p>批量改密码</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># nano all_pass.txt #编辑一个密码文件</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># cat all_pass.txt  #查看</span>
user00:oracle
user01:oracle
user02:oracle
user03:oracle
user04:oracle
user05:oracle
user06:oracle
user07:oracle
user08:oracle
user09:oracle
user10:oracle
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># cat all_pass.txt  | chpasswd #批量修改密码</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>练习5-权限判断</h2>
<p>1 、当用户xiaoming 对/testdir  目录无执行权限时，意味着无法做哪些操作？</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>无法进入目录
</pre></div>
</div>
<p>2 、当用户xiaoqiang 对/testdir  目录无读权限时，意味着无法做哪些操作？</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>无法查看目录下的文件
</pre></div>
</div>
<p>3 、当用户wangcai  对/testdir  目录无写权限时，该目录下的只读文件file1 是否可修改和删除？</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>不可修改，无法删除
</pre></div>
</div>
<p>4 、当用户wangcai  对/testdir  目录有写和执行权限时，该目录下的只读文件file1 是否可修改和删除？</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>不可修改，但是可以删除
</pre></div>
</div>
<p>5 、复制/etc/fstab 文件到/var/tmp 下，设置文件所有者为wangcai 读写权限，所属组为sysadmins 组有读写权限，其他人无权限</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 app<span class="o">]</span>$ chown wangcai:sysadmins /var/tmp/fstab
<span class="o">[</span>root@centos7 app<span class="o">]</span>$ chmod <span class="m">660</span> /var/tmp/fstab
</pre></div>
</div>
</div>
<div class="section" id="getfacl-setfacl-chmod">
<h2>练习6-getfacl,setfacl,chmod</h2>
<p>1 、在/testdir/dir 里创建的新文件自动属于g1 组，组g2 的成员如：alice 能对这些新文件有读写权限，组g3的成员如：tom 只能对新文件有读权限，其它用户（不属于g1,g2,g3 ）不能访问这个文件夹。</p>
<p>分析下题目
* 1）创建一个目录
* 2）自动属于g1组，这个应该设置gid,且组名为g1
* 3)alice 在g2组，需要先创建用户，读写权限
* 4）tome在g3组， 需要创建用户，有读权限
* 5）其他用户无权限</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># mkdir /testdir/dir -pv</span>
mkdir: created directory <span class="sb">`</span>/testdir<span class="s1">&#39;</span>
<span class="s1">mkdir: created directory `/testdir/dir&#39;</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># groupadd g1</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># chgrp  g1 /testdir/dir/</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># chmod g+s /testdir/dir/</span>
<span class="o">[</span>root@centos6 ~<span class="o">]</span><span class="c1"># cd /testdir/dir/</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># touch a.txt</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">0</span>
-rw-r--r--. <span class="m">1</span> root g1 <span class="m">0</span> Nov <span class="m">13</span> <span class="m">01</span>:44 a.txt
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># groupadd g2</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># useradd alice -G g2</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># setfacl -m &quot;d:g:g2:rw&quot; -R /testdir/dir/</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># groupadd g3</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># useradd tom -G g3</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># setfacl -m &quot;d:g:g3:r&quot; -R /testdir/dir/</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">0</span>
-rw-r--r--. <span class="m">1</span> root g1 <span class="m">0</span> Nov <span class="m">13</span> <span class="m">01</span>:44 a.txt
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># chmod o-rx /testdir/dir/ -R</span>
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># setfacl -m &quot;d:o::---&quot; -R /testdir/dir/</span>
</pre></div>
</div>
<p>2 、备份/testdir/dir 里所有文件的ACL 权限到/root/acl.txt 中，清除/testdir/dir 中所有ACL 权限，最后还原ACL</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># getfacl /testdir/dir -R &gt;/root/acl.txt</span>
getfacl: Removing leading <span class="s1">&#39;/&#39;</span> from absolute path names
<span class="o">[</span>root@centos6 dir<span class="o">]</span><span class="c1"># cd /testdir/</span>
<span class="o">[</span>root@centos6 testdir<span class="o">]</span><span class="c1"># getfacl -R dir &gt; /root/acl.txt</span>
<span class="o">[</span>root@centos6 testdir<span class="o">]</span><span class="c1"># setfacl -R -b dir</span>
<span class="o">[</span>root@centos6 testdir<span class="o">]</span><span class="c1"># setfacl --restore /root/acl.txt</span>
<span class="o">[</span>root@centos6 testdir<span class="o">]</span><span class="c1"># getfacl -R dir</span>
</pre></div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>